<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Futbol Ma√ß Sonucu Tahmin Sistemi (1X2)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-dark: #0d1117;
            --secondary-dark: #161b22;
            --tertiary-dark: #21262d;
            --accent-gold: #ffd700;
            --accent-blue: #0969da;
            --accent-green: #2ea043;
            --accent-red: #da3633;
            --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
            --border-color: #30363d;
            --hover-bg: #262c36;
        }

        body {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--secondary-dark) 100%);
            min-height: 100vh;
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
        }

        .main-container {
            background: rgba(33, 38, 45, 0.95);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            box-shadow: 0 16px 40px rgba(0,0,0,0.5);
            backdrop-filter: blur(20px);
            margin: 20px 0;
            overflow: hidden;
        }

        .header-section {
            background: linear-gradient(135deg, var(--tertiary-dark) 0%, var(--secondary-dark) 100%);
            color: var(--accent-gold);
            padding: 40px 30px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }

        .header-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-gold), var(--accent-green));
        }

        .header-section h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header-section p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        .nav-tabs {
            border-bottom: 2px solid #232946;
            margin-bottom: 20px;
        }
        .nav-tabs .nav-link {
            border: none;
            border-radius: 10px 10px 0 0;
            padding: 12px 20px;
            font-weight: 600;
            color: #bfc9d1;
            background: #232946;
            transition: all 0.3s ease;
        }
        .nav-tabs .nav-link.active {
            background: linear-gradient(135deg, #f7c873 0%, #f7b267 100%);
            color: #232946;
        }
        .feature-card {
            background: linear-gradient(135deg, var(--secondary-dark) 0%, var(--tertiary-dark) 100%);
            border-radius: 12px;
            padding: 30px;
            margin: 20px 0;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--accent-gold), var(--accent-blue));
        }

        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.4);
            border-color: var(--accent-gold);
        }

        .feature-card h3 {
            color: var(--accent-gold);
            font-weight: 600;
            margin-bottom: 15px;
        }

        .result-card {
            background: linear-gradient(135deg, var(--secondary-dark) 0%, var(--tertiary-dark) 100%);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 8px 24px rgba(0,0,0,0.25);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            position: relative;
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--accent-green);
        }
        .prediction-card {
            background: linear-gradient(135deg, #232946 0%, #181c24 100%);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #f7c873;
            color: #e0e0e0;
        }
        .metric-card {
            background: linear-gradient(135deg, var(--tertiary-dark) 0%, var(--secondary-dark) 100%);
            color: var(--accent-gold);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            margin: 10px 0;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-gold));
        }

        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.15);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(45deg, var(--accent-gold), #fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .match-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .match-card {
            background: linear-gradient(135deg, var(--secondary-dark) 0%, var(--tertiary-dark) 100%);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .match-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-gold), var(--accent-green));
        }

        .match-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.35);
            border-color: var(--accent-gold);
        }
        }
        .match-header {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--accent-gold);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .match-teams {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 15px;
            text-align: center;
            color: var(--text-primary);
        }

        .match-prediction {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin: 20px 0;
        }

        .match-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .match-date {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .match-countdown {
            font-size: 0.9rem;
            color: var(--accent-gold);
            font-weight: 600;
        }
        .prediction-badge {
            background: linear-gradient(135deg, var(--accent-gold) 0%, #ffc107 100%);
            color: var(--primary-dark);
            padding: 10px 18px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 1.1rem;
            text-shadow: none;
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
            transition: all 0.3s ease;
        }

        .prediction-badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(255, 215, 0, 0.4);
        }

        .confidence-badge {
            background: var(--tertiary-dark);
            color: var(--accent-gold);
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 0.9rem;
            border: 1px solid var(--border-color);
            font-weight: 600;
        }

        .btn-custom {
            background: linear-gradient(135deg, var(--accent-gold) 0%, #ffc107 100%);
            border: none;
            border-radius: 12px;
            padding: 14px 32px;
            color: var(--primary-dark);
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-custom:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(255, 215, 0, 0.35);
            color: var(--primary-dark);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--accent-blue) 0%, #0969da 100%);
            border: none;
            border-radius: 12px;
            padding: 14px 32px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(9, 105, 218, 0.2);
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #0969da 0%, var(--accent-blue) 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(9, 105, 218, 0.3);
            color: white;
        }
        .btn-predict {
            background: linear-gradient(135deg, #393e4c 0%, #232946 100%);
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            color: #f7c873;
            font-weight: 600;
        }
        .btn-predict:hover {
            background: linear-gradient(135deg, #f7c873 0%, #f7b267 100%);
            color: #232946;
        }
        .loading {
            background: linear-gradient(135deg, var(--secondary-dark) 0%, var(--tertiary-dark) 100%);
            color: var(--accent-gold);
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--border-color);
            margin: 20px 0;
        }

        .loading .spinner-border {
            color: var(--accent-gold) !important;
            width: 3rem;
            height: 3rem;
        }

        .prediction-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Outline buttons */
        .btn-outline-danger {
            border: 2px solid var(--accent-red);
            color: var(--accent-red);
            background: transparent;
            border-radius: 12px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-outline-danger:hover {
            background: var(--accent-red);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(218, 54, 51, 0.3);
        }

        .btn-outline-success {
            border: 2px solid var(--accent-green);
            color: var(--accent-green);
            background: transparent;
            border-radius: 12px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-outline-success:hover {
            background: var(--accent-green);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 160, 67, 0.3);
        }

        /* Responsive improvements */
        @media (max-width: 768px) {
            .match-grid {
                grid-template-columns: 1fr;
            }
            
            .header-section h1 {
                font-size: 2rem;
            }
            
            .main-container {
                margin: 10px;
                border-radius: 12px;
            }
            
            .feature-card {
                padding: 20px;
            }
        }
        .week-chip {
            display: inline-block;
            background: linear-gradient(135deg, var(--tertiary-dark) 0%, var(--secondary-dark) 100%);
            color: var(--accent-gold);
            padding: 8px 16px;
            border-radius: 25px;
            margin: 5px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border-color);
        }

        .week-chip:hover {
            background: linear-gradient(135deg, var(--accent-gold) 0%, #ffc107 100%);
            color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
        }

        .match-result {
            padding: 20px;
            margin: 15px 0;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--secondary-dark) 0%, var(--tertiary-dark) 100%);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .match-correct {
            background: linear-gradient(135deg, #0d2818 0%, var(--secondary-dark) 100%);
            border-left: 4px solid var(--accent-green);
        }

        .match-wrong {
            background: linear-gradient(135deg, #2d1a1a 0%, var(--secondary-dark) 100%);
            border-left: 4px solid var(--accent-red);
        }

        .match-unplayed {
            border-left: 4px solid var(--accent-gold);
            background: linear-gradient(135deg, #2a2418 0%, var(--secondary-dark) 100%);
        }
        .prediction-group {
            display: flex;
            align-items: center;
        }
        .badge.bg-warning {
            background: linear-gradient(135deg, var(--accent-gold) 0%, #ffc107 100%) !important;
            color: var(--primary-dark) !important;
            font-weight: 600 !important;
            padding: 6px 12px !important;
            border-radius: 20px !important;
        }

        .badge.bg-primary {
            background: linear-gradient(135deg, var(--accent-blue) 0%, #0969da 100%) !important;
            color: white !important;
            font-weight: 600 !important;
            padding: 6px 12px !important;
            border-radius: 20px !important;
        }

        .badge.bg-success {
            background: linear-gradient(135deg, var(--accent-green) 0%, #2ea043 100%) !important;
            color: white !important;
            font-weight: 600 !important;
            padding: 6px 12px !important;
            border-radius: 20px !important;
        }

        .badge.bg-secondary {
            background: linear-gradient(135deg, var(--tertiary-dark) 0%, var(--secondary-dark) 100%) !important;
            color: var(--accent-gold) !important;
            border: 1px solid var(--border-color) !important;
            font-weight: 600 !important;
            padding: 6px 12px !important;
            border-radius: 20px !important;
        }

        .badge.bg-danger {
            background: linear-gradient(135deg, var(--accent-red) 0%, #da3633 100%) !important;
            color: white !important;
            font-weight: 600 !important;
            padding: 6px 12px !important;
            border-radius: 20px !important;
        }

        .badge.bg-info {
            background: linear-gradient(135deg, var(--accent-blue) 0%, #17a2b8 100%) !important;
            color: white !important;
            font-weight: 600 !important;
            padding: 6px 12px !important;
            border-radius: 20px !important;
        }
        .alert {
            background: #232946;
            color: #ffe066;
            border: 1px solid #ffe066;
        }
        input, select, textarea {
            background: var(--secondary-dark) !important;
            color: var(--text-primary) !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 8px !important;
            padding: 12px 16px !important;
            transition: all 0.3s ease !important;
        }

        input:focus, select:focus, textarea:focus {
            background: var(--tertiary-dark) !important;
            color: var(--text-primary) !important;
            border: 1px solid var(--accent-gold) !important;
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1) !important;
            outline: none !important;
        }

        .form-label {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 8px;
        }

        ::placeholder {
            color: var(--text-secondary) !important;
            opacity: 0.8 !important;
        }

        .alert {
            background: linear-gradient(135deg, var(--tertiary-dark) 0%, var(--secondary-dark) 100%);
            color: var(--accent-gold);
            border: 1px solid var(--accent-gold);
            border-radius: 12px;
            padding: 16px 20px;
            margin: 15px 0;
        }

        .alert-info {
            background: linear-gradient(135deg, #0a1a2a 0%, var(--secondary-dark) 100%);
            color: var(--accent-blue);
            border: 1px solid var(--accent-blue);
        }

        .alert-warning {
            background: linear-gradient(135deg, #2a2a0a 0%, var(--secondary-dark) 100%);
            color: var(--accent-gold);
            border: 1px solid var(--accent-gold);
        }

        .alert-danger {
            background: linear-gradient(135deg, #2a0a0a 0%, var(--secondary-dark) 100%);
            color: var(--accent-red);
            border: 1px solid var(--accent-red);
        }

        /* Kalan btn-predict stil eksikse ekleyelim */
        .btn-predict {
            background: linear-gradient(135deg, var(--tertiary-dark) 0%, var(--secondary-dark) 100%);
            border: 2px solid var(--accent-gold);
            border-radius: 12px;
            padding: 12px 30px;
            color: var(--accent-gold);
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-predict:hover {
            background: linear-gradient(135deg, var(--accent-gold) 0%, #ffc107 100%);
            color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-container">
            <!-- Header -->
            <div class="header-section">
                <h1><i class="fas fa-futbol"></i> Futbol Ma√ß Sonucu Tahmin Sistemi</h1>
                <p class="mb-0">1X2 Sonu√ß Tahmini (Sadece Galibiyetli/Beraberlik/Maƒülubiyet)</p>
            </div>

            <div class="p-4">
                    <!-- Parametric Backtest -->
                    <div class="feature-card">
                        <h3><i class="fas fa-calendar-week"></i> Parametric Backtest</h3>
                        <p>Herhangi bir hafta i√ßin model performansƒ±nƒ± test edin veya oynanmamƒ±≈ü ma√ßlarƒ± tahmin edin.</p>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="weekSelect" class="form-label">Test Haftasƒ±:</label>
                                    <select id="weekSelect" class="form-select">
                                        <option value="">Hafta se√ßin...</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="dataFile" class="form-label">Veri Dosyasƒ±:</label>
                                    <select id="dataFile" class="form-select">
                                        <option value="data/ALM_stat.json">üá©üá™ Alman Ligi (Bundesliga)</option>
                                        <option value="data/BEL_stat.json">üáßüá™ Bel√ßika Ligi</option>
                                        <option value="data/BRA_stat.json">üáßüá∑ Brezilya Ligi</option>
                                        <option value="data/ENG_stat.json">üè¥ ƒ∞ngiliz Premier Ligi</option>
                                        <option value="data/ENG_C_stat.json">üè¥ ƒ∞ngiliz Championship</option>
                                        <option value="data/ESP_stat.json">üá™üá∏ ƒ∞spanya La Liga</option>
                                        <option value="data/FRA_stat.json">üá´üá∑ Fransa Ligue 1</option>
                                        <option value="data/HOL_stat.json">üá≥üá± Hollanda Eredivisie</option>
                                        <option value="data/HOL_2_stat.json">üá≥üá± Hollanda 2. Lig</option>
                                        <option value="data/POR_stat.json">üáµüáπ Portekiz Ligi</option>
                                        <option value="data/TR_stat.json">üáπüá∑ T√ºrkiye S√ºper Lig</option>
                                        <option value="data/ISVEC_stat.json">üá∏üá™ ƒ∞sve√ß Ligi</option>
                                        <option value="data/NORVEC_stat.json">üá≥üá¥ Norve√ß Ligi</option>
                                        <option value="data/FINLANDIYA_stat.json">üá´üáÆ Finlandiya Ligi</option>
                                        <option value="data/JAP_stat.json">üáØüáµ Japonya J-League</option>
                                        <option value="data/GK_stat.json">üåç G√ºney Kore K-League</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mt-3">
                                <button id="runBacktest" class="btn btn-custom me-2">
                                    <i class="fas fa-play"></i> Backtest √áalƒ±≈ütƒ±r
                                </button>
                                <button id="testDeterminism" class="btn btn-warning me-2">
                                    <i class="fas fa-sync-alt"></i> Determinizm Testi
                                </button>
                                <button id="clearHistory" class="btn btn-outline-danger me-2">
                                    <i class="fas fa-trash"></i> Temizle
                                </button>
                                <button id="exportResults" class="btn btn-outline-success">
                                    <i class="fas fa-download"></i> Sonu√ßlarƒ± ƒ∞ndir
                                </button>
                            </div>
                        </div>

                        <!-- Loading -->
                        <div id="backtestLoading" class="loading" style="display:none;">
                            <div class="spinner-border text-primary" role="status"></div>
                            <p class="mt-2">Backtest √ßalƒ±≈ütƒ±rƒ±lƒ±yor...</p>
                        </div>

                        <!-- Results -->
                        <div id="backtestResults" style="display: none;">
                            <div class="row" id="backtestMetrics"></div>
                            <div class="result-card">
                                <h4><i class="fas fa-list"></i> Ma√ß Sonu√ßlarƒ±</h4>
                                <div id="backtestMatches"></div>
                            </div>
                        </div>

                        <!-- GP Tahmin Sistemi -->
                        <div class="feature-card">
                            <h3><i class="fas fa-brain"></i> GP Tahmin Sistemi</h3>
                            <p>Gaussian Process ile geli≈ümi≈ü ma√ß sonucu tahmini. Veri sƒ±zƒ±ntƒ±sƒ± olmadan ger√ßek tahmin yapar.</p>
                            
                            <!-- GP Model Durumu -->
                            <div class="row mb-3">
                                <div class="col-12">
                                    <div class="alert alert-info" id="gpStatus">
                                        <i class="fas fa-info-circle"></i> Model durumu kontrol ediliyor...
                                    </div>
                                </div>
                            </div>
                            
                            <!-- GP Model Eƒüitimi -->
                            <div class="row mb-3">
                                <div class="col-md-8">
                                    <label for="gpDataFile" class="form-label">Eƒüitim Veri Dosyasƒ±:</label>
                                    <select id="gpDataFile" class="form-select">
                                        <option value="data/TR_stat.json">üáπüá∑ T√ºrkiye S√ºper Lig</option>
                                        <option value="data/ENG_stat.json">üè¥ ƒ∞ngiliz Premier Ligi</option>
                                        <option value="data/ESP_stat.json">üá™üá∏ ƒ∞spanya La Liga</option>
                                        <option value="data/ALM_stat.json">üá©üá™ Alman Ligi (Bundesliga)</option>
                                        <option value="data/FRA_stat.json">üá´üá∑ Fransa Ligue 1</option>
                                        <option value="data/HOL_stat.json">üá≥üá± Hollanda Eredivisie</option>
                                        <option value="data/POR_stat.json">üáµüáπ Portekiz Ligi</option>
                                        <option value="data/BEL_stat.json">üáßüá™ Bel√ßika Ligi</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">&nbsp;</label>
                                    <button id="gpTrainBtn" class="btn btn-primary d-block w-100">
                                        <i class="fas fa-cogs"></i> Modeli Eƒüit
                                    </button>
                                </div>
                            </div>
                            
                            <!-- GP Tahmin Formu -->
                            <div id="gpPredictionForm" style="display: none;">
                                <h5><i class="fas fa-predict"></i> Ma√ß Tahmini</h5>
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label for="gpHomeTeam" class="form-label">Ev Sahibi Takƒ±m:</label>
                                        <input type="text" id="gpHomeTeam" class="form-control" placeholder="Galatasaray">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="gpAwayTeam" class="form-label">Deplasman Takƒ±mƒ±:</label>
                                        <input type="text" id="gpAwayTeam" class="form-control" placeholder="Fenerbah√ße">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="gpWeek" class="form-label">Hafta:</label>
                                        <input type="number" id="gpWeek" class="form-control" value="20" min="1" max="38">
                                    </div>
                                </div>
                                
                                <!-- Geli≈ümi≈ü √ñzellikler -->
                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <label for="homeWinRate" class="form-label">Ev Sahibi Galibiyet Oranƒ±:</label>
                                        <input type="number" id="homeWinRate" class="form-control" value="0.5" min="0" max="1" step="0.1">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="awayWinRate" class="form-label">Deplasman Galibiyet Oranƒ±:</label>
                                        <input type="number" id="awayWinRate" class="form-control" value="0.5" min="0" max="1" step="0.1">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="homeAvgGoals" class="form-label">Ev Sahibi Ort. Gol:</label>
                                        <input type="number" id="homeAvgGoals" class="form-control" value="1.5" min="0" max="5" step="0.1">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="awayAvgGoals" class="form-label">Deplasman Ort. Gol:</label>
                                        <input type="number" id="awayAvgGoals" class="form-control" value="1.5" min="0" max="5" step="0.1">
                                    </div>
                                </div>
                                
                                <div class="text-center">
                                    <button id="gpPredictBtn" class="btn btn-success">
                                        <i class="fas fa-magic"></i> Tahmin Yap
                                    </button>
                                </div>
                            </div>
                            
                            <!-- GP Loading -->
                            <div id="gpLoading" class="loading" style="display:none;">
                                <div class="spinner-border text-primary" role="status"></div>
                                <p class="mt-2">ƒ∞≈ülem yapƒ±lƒ±yor...</p>
                            </div>
                            
                            <!-- GP Sonu√ßlarƒ± -->
                            <div id="gpResults" style="display: none;">
                                <div class="result-card">
                                    <h4><i class="fas fa-trophy"></i> Tahmin Sonucu</h4>
                                    <div id="gpPredictionResult"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Advanced GP Analysis -->
                        <div class="feature-card">
                            <h3><i class="fas fa-cogs"></i> Geli≈ümi≈ü GP Analizi</h3>
                            <p>Risk analizi, entropy hesaplama, s√ºrpriz sonu√ß tespiti ve geli≈ümi≈ü √∂zellik m√ºhendisliƒüi.</p>
                            
                            <!-- Advanced GP Model Training -->
                            <div class="row mb-3">
                                <div class="col-md-8">
                                    <label for="advancedGpDataFile" class="form-label">Geli≈ümi≈ü Eƒüitim Veri Dosyasƒ±:</label>
                                    <select id="advancedGpDataFile" class="form-select">
                                        <option value="data/TR_stat.json">üáπüá∑ T√ºrkiye S√ºper Lig</option>
                                        <option value="data/ENG_stat.json">üè¥ ƒ∞ngiliz Premier Ligi</option>
                                        <option value="data/ESP_stat.json">üá™üá∏ ƒ∞spanya La Liga</option>
                                        <option value="data/ALM_stat.json">üá©üá™ Alman Ligi (Bundesliga)</option>
                                        <option value="data/FRA_stat.json">üá´üá∑ Fransa Ligue 1</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">&nbsp;</label>
                                    <button id="advancedGpTrainBtn" class="btn btn-primary d-block w-100">
                                        <i class="fas fa-brain"></i> Geli≈ümi≈ü Eƒüitim
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Advanced Prediction Form -->
                            <div id="advancedGpPredictionForm" style="display: none;">
                                <h5><i class="fas fa-chart-line"></i> Risk Analizi ile Tahmin</h5>
                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <label for="advHomeTeam" class="form-label">Ev Sahibi:</label>
                                        <input type="text" id="advHomeTeam" class="form-control" placeholder="Galatasaray">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="advAwayTeam" class="form-label">Deplasman:</label>
                                        <input type="text" id="advAwayTeam" class="form-control" placeholder="Fenerbah√ße">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="advWeek" class="form-label">Hafta:</label>
                                        <input type="number" id="advWeek" class="form-control" value="20" min="1" max="38">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="advH2hMatches" class="form-label">H2H Ma√ß Sayƒ±sƒ±:</label>
                                        <input type="number" id="advH2hMatches" class="form-control" value="5" min="0" max="20">
                                    </div>
                                </div>
                                
                                <!-- Form Analysis -->
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label for="advHomeForm5" class="form-label">Ev Sahibi Form (Son 5):</label>
                                        <input type="number" id="advHomeForm5" class="form-control" value="0.6" min="0" max="1" step="0.1">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="advAwayForm5" class="form-label">Deplasman Form (Son 5):</label>
                                        <input type="number" id="advAwayForm5" class="form-control" value="0.5" min="0" max="1" step="0.1">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="advHomeAdvantage" class="form-label">Ev Sahibi Avantajƒ±:</label>
                                        <input type="number" id="advHomeAdvantage" class="form-control" value="0.1" min="0" max="0.5" step="0.05">
                                    </div>
                                </div>
                                
                                <div class="text-center">
                                    <button id="advancedGpPredictBtn" class="btn btn-success me-2">
                                        <i class="fas fa-brain"></i> Geli≈ümi≈ü Tahmin
                                    </button>
                                    <button id="upsetDetectionBtn" class="btn btn-warning">
                                        <i class="fas fa-exclamation-triangle"></i> S√ºrpriz Tespiti
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Advanced GP Results -->
                            <div id="advancedGpResults" style="display: none;">
                                <div class="result-card">
                                    <h4><i class="fas fa-chart-area"></i> Geli≈ümi≈ü Analiz Sonucu</h4>
                                    <div id="advancedGpPredictionResult"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Multi-League Analysis -->
                        <div class="feature-card">
                            <h3><i class="fas fa-globe"></i> Multi-League Analizi</h3>
                            <p>Farklƒ± liglerde performans kar≈üƒ±la≈ütƒ±rmasƒ± ve cross-league tahminleri.</p>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <button id="multiLeagueTrainBtn" class="btn btn-primary d-block w-100">
                                        <i class="fas fa-globe-americas"></i> T√ºm Ligleri Eƒüit
                                    </button>
                                </div>
                                <div class="col-md-6">
                                    <button id="multiLeagueAnalysisBtn" class="btn btn-info d-block w-100">
                                        <i class="fas fa-chart-bar"></i> Lig Kar≈üƒ±la≈ütƒ±rmasƒ±
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Cross-League Prediction -->
                            <div id="crossLeaguePredictionForm" style="display: none;">
                                <h5><i class="fas fa-exchange-alt"></i> Cross-League Tahmin</h5>
                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <label for="crossLeagueCode" class="form-label">Lig Se√ßin:</label>
                                        <select id="crossLeagueCode" class="form-select">
                                            <option value="TR">üáπüá∑ T√ºrkiye</option>
                                            <option value="ENG">üè¥ ƒ∞ngiltere</option>
                                            <option value="ESP">üá™üá∏ ƒ∞spanya</option>
                                            <option value="ALM">üá©üá™ Almanya</option>
                                            <option value="FRA">üá´üá∑ Fransa</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="crossHomeTeam" class="form-label">Ev Sahibi:</label>
                                        <input type="text" id="crossHomeTeam" class="form-control" placeholder="Takƒ±m adƒ±">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="crossAwayTeam" class="form-label">Deplasman:</label>
                                        <input type="text" id="crossAwayTeam" class="form-control" placeholder="Takƒ±m adƒ±">
                                    </div>
                                    <div class="col-md-3">
                                        <button id="crossLeaguePredictBtn" class="btn btn-success" style="margin-top: 32px;">
                                            <i class="fas fa-globe"></i> Cross Tahmin
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Multi-League Results -->
                            <div id="multiLeagueResults" style="display: none;">
                                <div class="result-card">
                                    <h4><i class="fas fa-trophy"></i> Multi-League Sonu√ßlarƒ±</h4>
                                    <div id="multiLeagueAnalysisResult"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Tracking -->
                        <div class="feature-card">
                            <h3><i class="fas fa-chart-line"></i> Performans Takibi</h3>
                            <p>Tahmin ge√ßmi≈üi, ba≈üarƒ± oranlarƒ± ve zaman i√ßinde model performansƒ± analizi.</p>
                            
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <button id="predictionHistoryBtn" class="btn btn-primary d-block w-100">
                                        <i class="fas fa-history"></i> Tahmin Ge√ßmi≈üi
                                    </button>
                                </div>
                                <div class="col-md-4">
                                    <button id="featureImportanceBtn" class="btn btn-info d-block w-100">
                                        <i class="fas fa-list-ol"></i> √ñzellik √ñnem Sƒ±rasƒ±
                                    </button>
                                </div>
                                <div class="col-md-4">
                                    <button id="performanceTrackingBtn" class="btn btn-success d-block w-100">
                                        <i class="fas fa-chart-area"></i> Performans Analizi
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Performance Results -->
                            <div id="performanceResults" style="display: none;">
                                <div class="result-card">
                                    <h4><i class="fas fa-analytics"></i> Performans Verileri</h4>
                                    <div id="performanceAnalysisResult"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Available Weeks -->
                        <div class="feature-card">
                            <h5><i class="fas fa-info-circle"></i> Mevcut Haftalar</h5>
                            <div id="availableWeeks"></div>
                        </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global deƒüi≈ükenler
        let availableWeeks = [];
        
        // Sayfa y√ºklendiƒüinde
        document.addEventListener('DOMContentLoaded', function() {
            loadAvailableWeeks();
            
            // Veri dosyasƒ± deƒüi≈ütiƒüinde haftalarƒ± yeniden y√ºkle
            document.getElementById('dataFile').addEventListener('change', function() {
                loadAvailableWeeks(this.value);
            });
            
            document.getElementById('unplayedDataFile').addEventListener('change', function() {
                loadAvailableWeeks(this.value);
            });
            
            // GP event listeners
            document.getElementById('gpTrainBtn').addEventListener('click', trainGPModel);
            document.getElementById('gpPredictBtn').addEventListener('click', makeGPPrediction);
            
            // Advanced GP event listeners
            document.getElementById('trainAdvancedGPBtn').addEventListener('click', trainAdvancedGP);
            document.getElementById('predictAdvancedGPBtn').addEventListener('click', predictAdvancedGP);
            
            // Multi-league event listeners
            document.getElementById('trainAllLeaguesBtn').addEventListener('click', trainAllLeagues);
            document.getElementById('analyzeMultiLeagueBtn').addEventListener('click', analyzeMultiLeague);
            document.getElementById('predictCrossLeagueBtn').addEventListener('click', predictCrossLeague);
            
            // Performance tracking event listeners
            document.getElementById('loadHistoryBtn').addEventListener('click', loadPredictionHistory);
            document.getElementById('trackPerformanceBtn').addEventListener('click', trackPerformance);
            document.getElementById('analyzeFeatureBtn').addEventListener('click', analyzeFeatureImportance);
            
            // GP model durumunu kontrol et
            checkGPStatus();
            
            // Sayfa ilk a√ßƒ±lƒ±≈üta loader ve sonu√ßlar gizli olsun
            hideLoading('backtestLoading');
            hideElement('backtestResults');
            hideElement('unplayedResults');
            hideLoading('gpLoading');
            hideElement('gpResults');
            hideElement('advancedGPResults');
            hideElement('multiLeagueResults');
            hideElement('crossLeagueResults');
            hideElement('historyResults');
            hideElement('performanceResults');
            hideElement('featureImportanceResults');
        });

        // Mevcut haftalarƒ± y√ºkle
        async function loadAvailableWeeks(dataFile = null) {
            try {
                const selectedDataFile = dataFile || document.getElementById('dataFile').value || 'data/ALM_stat.json';
                const response = await fetch(`/api/available-weeks?data_file=${encodeURIComponent(selectedDataFile)}`);
                const data = await response.json();
                
                if (data.error) {
                    showAlert('danger', data.error);
                    return;
                }
                
                availableWeeks = data.weeks;
                
                // Hafta se√ßiciyi doldur
                const weekSelect = document.getElementById('weekSelect');
                weekSelect.innerHTML = '<option value="">Hafta se√ßin...</option>';
                
                data.weeks.forEach(week => {
                    const option = document.createElement('option');
                    option.value = week;
                    option.textContent = `${week}. Hafta`;
                    weekSelect.appendChild(option);
                });
                
                // Mevcut haftalarƒ± g√∂ster
                const availableWeeksDiv = document.getElementById('availableWeeks');
                availableWeeksDiv.innerHTML = data.weeks.map(week => 
                    `<span class="week-chip" onclick="selectWeek(${week})">${week}</span>`
                ).join('');
                
                const leagueInfo = data.league || 'Bilinmeyen Lig';
                // Ba≈üarƒ± mesajƒ± kaldƒ±rƒ±ldƒ± - sadece hata mesajlarƒ± g√∂sterilecek
                
            } catch (error) {
                showAlert('danger', 'Haftalar y√ºklenirken hata: ' + error.message);
            }
        }

        // Hafta se√ß
        function selectWeek(week) {
            document.getElementById('weekSelect').value = week;
        }

        // Parametric Backtest √áalƒ±≈ütƒ±r
        document.getElementById('runBacktest').addEventListener('click', async function() {
            const week = document.getElementById('weekSelect').value;
            const dataFile = document.getElementById('dataFile').value;
            
            if (!week) {
                showAlert('warning', 'L√ºtfen bir hafta se√ßin');
                return;
            }
            
            showLoading('backtestLoading');
            hideElement('backtestResults');
            
            try {
                const response = await fetch('/api/run-backtest', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        week: parseInt(week),
                        data_file: dataFile
                    })
                });
                
                const data = await response.json();
                
                if (data.error) {
                    showAlert('danger', data.error);
                    return;
                }
                
                // Eƒüer sadece oynanmamƒ±≈ü ma√ß tahmini varsa
                if (data.unplayed_predictions) {
                    const matchesDiv = document.getElementById('backtestMatches');
                    
                    // Ma√ßlarƒ± y√ºzdeye g√∂re sƒ±rala (en y√ºksek √∂nce)
                    const sortedMatches = data.unplayed_predictions.map((match) => {
                        const name = match[0];
                        const predData = match[1];
                        const confidence = typeof predData.confidence === 'number' ? predData.confidence : 0;
                        return { match, name, predData, confidence };
                    }).sort((a, b) => b.confidence - a.confidence);
                    
                    matchesDiv.innerHTML = `
                        <div class="match-grid">
                            ${sortedMatches.map((item) => {
                                const { name, predData } = item;
                                
                                // Yeni 1X2 format i√ßin g√ºvenli eri≈üim
                                const result = predData.predicted_result || 'N/A';
                                const resultMeaning = predData.result_meaning || 'Bilinmeyen';
                                const homeWinProb = typeof predData.home_win_prob === 'number' ? (predData.home_win_prob * 100).toFixed(0) + '%' : (predData.home_win_prob || '0%');
                                const drawProb = typeof predData.draw_prob === 'number' ? (predData.draw_prob * 100).toFixed(0) + '%' : (predData.draw_prob || '0%');
                                const awayWinProb = typeof predData.away_win_prob === 'number' ? (predData.away_win_prob * 100).toFixed(0) + '%' : (predData.away_win_prob || '0%');
                                const confidence = typeof predData.confidence === 'number' ? (predData.confidence * 100).toFixed(0) + '%' : (predData.confidence || '0%');
                                
                                // En y√ºksek olasƒ±lƒ±ƒüƒ± bul
                                const homeWinProbNum = typeof predData.home_win_prob === 'number' ? predData.home_win_prob : 0;
                                const drawProbNum = typeof predData.draw_prob === 'number' ? predData.draw_prob : 0;
                                const awayWinProbNum = typeof predData.away_win_prob === 'number' ? predData.away_win_prob : 0;
                                
                                let highestProb = '';
                                let highestValue = Math.max(homeWinProbNum, drawProbNum, awayWinProbNum);
                                
                                if (homeWinProbNum === highestValue) {
                                    highestProb = 'MS 1: ' + homeWinProb;
                                } else if (drawProbNum === highestValue) {
                                    highestProb = 'MS X: ' + drawProb;
                                } else {
                                    highestProb = 'MS 2: ' + awayWinProb;
                                }
                                
                                // Tarih ve saat bilgisi
                                const matchDate = predData.date || 'Tarih belirtilmemi≈ü';
                                const matchTime = predData.time || '--:--';
                                const timeUntilMatch = calculateTimeUntilMatch(matchDate, matchTime);
                                
                                return `
                                    <div class="match-card">
                                        <div class="match-header">
                                            <i class="fas fa-calendar-day"></i> ${matchDate} - ${matchTime}
                                        </div>
                                        <div class="match-teams">${name}</div>
                                        <div class="match-prediction">
                                            <span class="prediction-badge">${highestProb}</span>
                                            <span class="confidence-badge">G√ºven: ${confidence}</span>
                                        </div>
                                        <div class="match-info">
                                            <div class="match-date">
                                                <i class="fas fa-clock"></i> ${resultMeaning}
                                            </div>
                                            <div class="match-countdown">
                                                ${timeUntilMatch}
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                    document.getElementById('backtestMetrics').innerHTML = `<div class="col-12"><div class="alert alert-info">Bu haftada sadece oynanmamƒ±≈ü ma√ßlar i√ßin tahmin √ºretildi.</div></div>`;
                    showElement('backtestResults');
                    return;
                }
                
                // Normal backtest sonu√ßlarƒ±
                if (data.result && data.result.matches) {
                    displayBacktestResults(data.result);
                } else if (data.matches) {
                    displayBacktestResults(data);
                } else {
                    showAlert('warning', 'Backtest sonu√ßlarƒ± bulunamadƒ±');
                }
                
                showElement('backtestResults');
                
                // Normal backtest sonu√ßlarƒ±nƒ± g√∂ster
                if (data.result) {
                    displayBacktestResults(data.result);
                    // Ba≈üarƒ± mesajƒ± kaldƒ±rƒ±ldƒ± - sadece hata mesajlarƒ± g√∂sterilecek
                } else {
                    showAlert('warning', 'Backtest tamamlandƒ± ama sonu√ß verisi eksik.');
                    console.log('Gelen veri yapƒ±sƒ±:', data);
                }
                
            } catch (error) {
                showAlert('danger', 'Backtest hatasƒ±: ' + error.message);
                console.error('Backtest error details:', error);
            } finally {
                hideLoading('backtestLoading');
            }
        });

        // Sonu√ßlarƒ± g√∂ster fonksiyonlarƒ±
        function displayBacktestResults(result) {
            // G√ºvenli metrics eri≈üimi
            const metrics = result && result.metrics ? result.metrics : null;
            
            if (!metrics) {
                document.getElementById('backtestMetrics').innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            Metrik verileri y√ºklenemedi. Sonu√ß yapƒ±sƒ±: ${JSON.stringify(result)}
                        </div>
                    </div>
                `;
                return;
            }
            
            document.getElementById('backtestMetrics').innerHTML = `
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value">${metrics.exact_matches || 0}</div>
                        <div>Doƒüru Tahmin</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value">${metrics.accuracy ? (metrics.accuracy * 100).toFixed(1) + '%' : '0%'}</div>
                        <div>Ba≈üarƒ± Oranƒ±</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value">${metrics.close_rate ? (metrics.close_rate * 100).toFixed(1) + '%' : '0%'}</div>
                        <div>Yakƒ±n Tahmin</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value">${metrics.result_accuracy ? (metrics.result_accuracy * 100).toFixed(1) + '%' : '0%'}</div>
                        <div>Sonu√ß Doƒüruluk</div>
                    </div>
                </div>
            `;
            
            // G√ºvenli predictions eri≈üimi
            const predictions = result && result.predictions ? result.predictions : [];
            
            if (predictions.length === 0) {
                document.getElementById('backtestMatches').innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        Ma√ß tahmin verileri bulunamadƒ±.
                    </div>
                `;
            } else {
                document.getElementById('backtestMatches').innerHTML = predictions.map(([name, pred, actual]) => {
                    // G√ºvenli veri kontrol√º
                    const safeName = name || 'Bilinmeyen Ma√ß';
                    
                    // Yeni 1X2 format kontrol√º
                    let predResult, actualResult, isCorrect;
                    
                    if (typeof pred === 'object' && pred.predicted_result) {
                        // Yeni 1X2 format
                        predResult = pred.predicted_result;
                        const predMeaning = pred.result_meaning || 'Bilinmeyen';
                        const confidence = typeof pred.confidence === 'number' ? (pred.confidence * 100).toFixed(0) + '%' : (pred.confidence || '0%');
                        const homeWinProb = typeof pred.home_win_prob === 'number' ? (pred.home_win_prob * 100).toFixed(0) + '%' : (pred.home_win_prob || '0%');
                        const drawProb = typeof pred.draw_prob === 'number' ? (pred.draw_prob * 100).toFixed(0) + '%' : (pred.draw_prob || '0%');
                        const awayWinProb = typeof pred.away_win_prob === 'number' ? (pred.away_win_prob * 100).toFixed(0) + '%' : (pred.away_win_prob || '0%');
                        
                        // En y√ºksek olasƒ±lƒ±ƒüƒ± bul
                        const homeWinProbNum = typeof pred.home_win_prob === 'number' ? pred.home_win_prob : 0;
                        const drawProbNum = typeof pred.draw_prob === 'number' ? pred.draw_prob : 0;
                        const awayWinProbNum = typeof pred.away_win_prob === 'number' ? pred.away_win_prob : 0;
                        
                        let highestProb = '';
                        let highestValue = Math.max(homeWinProbNum, drawProbNum, awayWinProbNum);
                        
                        if (homeWinProbNum === highestValue) {
                            highestProb = `MS 1: ${homeWinProb}`;
                        } else if (drawProbNum === highestValue) {
                            highestProb = `MS X: ${drawProb}`;
                        } else {
                            highestProb = `MS 2: ${awayWinProb}`;
                        }
                        
                        // Ger√ßek sonucu hesapla
                        if (Array.isArray(actual) && actual.length >= 2) {
                            const homeScore = actual[0];
                            const awayScore = actual[1];
                            if (homeScore > awayScore) actualResult = '1';
                            else if (homeScore === awayScore) actualResult = 'X';
                            else actualResult = '2';
                        } else {
                            actualResult = 'N/A';
                        }
                        
                        isCorrect = predResult === actualResult;
                        
                        return `
                            <div class="match-result ${isCorrect ? 'match-correct' : 'match-wrong'}">
                                <div class="mb-2"><strong>${safeName}</strong></div>
                                <div class="d-flex justify-content-between align-items-center flex-wrap">
                                    <div class="prediction-group mb-1">
                                        <span class="badge ${isCorrect ? 'bg-success' : 'bg-danger'} me-1">${predResult} - ${predMeaning}</span>
                                        <i class="fas fa-chevron-right text-muted mx-1"></i>
                                        <span class="badge ${isCorrect ? 'bg-success' : 'bg-danger'}">${actualResult}</span>
                                    </div>
                                    <div class="prediction-group mb-1">
                                        <small class="text-muted">G√ºven: ${confidence}</small>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-center gap-1 mt-1">
                                    <small class="badge bg-success text-white">${highestProb}</small>
                                </div>
                            </div>
                        `;
                    } else {
                        // Eski score-based format (geriye d√∂n√ºk uyumluluk)
                        const safePred = pred || [0, 0];
                        const safeActual = actual || [0, 0];
                        
                        const isScoreCorrect = safePred[0] === safeActual[0] && safePred[1] === safeActual[1];
                        
                        // Ma√ß sonucu hesapla (1X2)
                        const getMatchResult = (homeScore, awayScore) => {
                            if (homeScore > awayScore) return "1";
                            if (homeScore === awayScore) return "X";
                            return "2";
                        };
                        
                        const predMatchResult = getMatchResult(safePred[0], safePred[1]);
                        const actualMatchResult = getMatchResult(safeActual[0], safeActual[1]);
                        const isMatchResultCorrect = predMatchResult === actualMatchResult;
                        
                        return `
                            <div class="match-result ${isScoreCorrect ? 'match-correct' : 'match-wrong'}">
                                <div class="mb-2"><strong>${safeName}</strong></div>
                                <div class="d-flex justify-content-between align-items-center flex-wrap">
                                    <div class="prediction-group mb-1">
                                        <span class="badge ${isScoreCorrect ? 'bg-success' : 'bg-danger'} me-1">${safePred[0]}-${safePred[1]}</span>
                                        <i class="fas fa-chevron-right text-muted mx-1"></i>
                                        <span class="badge ${isScoreCorrect ? 'bg-success' : 'bg-danger'} me-3">${safeActual[0]}-${safeActual[1]}</span>
                                    </div>
                                    <div class="prediction-group mb-1">
                                        <span class="badge ${isMatchResultCorrect ? 'bg-success' : 'bg-danger'} me-1">${predMatchResult}</span>
                                        <i class="fas fa-chevron-right text-muted mx-1"></i>
                                        <span class="badge ${isMatchResultCorrect ? 'bg-success' : 'bg-danger'}">${actualMatchResult}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                }).join('');
            }
            
            showElement('backtestResults');
        }

        // Yardƒ±mcƒ± fonksiyonlar
        function calculateTimeUntilMatch(matchDate, matchTime) {
            try {
                // ≈ûimdilik basit bir format d√∂nd√ºr
                if (!matchDate || matchDate === 'Tarih belirtilmemi≈ü') {
                    return '<i class="fas fa-question"></i> Tarih bilinmiyor';
                }
                
                // Basit tarih formatƒ± i√ßin
                const now = new Date();
                return '<i class="fas fa-hourglass-half"></i> Yakƒ±nda';
            } catch (error) {
                return '<i class="fas fa-exclamation"></i> Hesaplanamadƒ±';
            }
        }
        
        // DataTables ile oynanmamƒ±≈ü ma√ßlarƒ± g√∂ster
        function displayUnplayedMatchesInDataTable(unplayedPredictions) {
            // Eƒüer DataTable zaten varsa, yok et
            if ($.fn.DataTable.isDataTable('#matchResultsTable')) {
                $('#matchResultsTable').DataTable().destroy();
            }
            
            // Tablo verilerini hazƒ±rla
            const tableData = unplayedPredictions.map((match) => {
                const name = match[0];
                const predData = match[1];
                
                const result = predData.predicted_result || 'N/A';
                const resultMeaning = predData.result_meaning || 'Bilinmeyen';
                const homeWinProb = typeof predData.home_win_prob === 'number' ? (predData.home_win_prob * 100).toFixed(0) : '0';
                const drawProb = typeof predData.draw_prob === 'number' ? (predData.draw_prob * 100).toFixed(0) : '0';
                const awayWinProb = typeof predData.away_win_prob === 'number' ? (predData.away_win_prob * 100).toFixed(0) : '0';
                const confidence = typeof predData.confidence === 'number' ? (predData.confidence * 100).toFixed(0) : '0';
                
                const matchDate = predData.date || 'Tarih belirtilmemi≈ü';
                const timeUntilMatch = 'Oynanmamƒ±≈ü';
                
                return [
                    matchDate,
                    name,
                    `<span class="badge bg-primary">${result}</span>`,
                    '<span class="badge bg-secondary">-</span>',
                    '<span class="badge bg-warning">Bekleniyor</span>',
                    confidence,
                    homeWinProb,
                    drawProb,
                    awayWinProb,
                    `<span class="badge bg-info">${timeUntilMatch}</span>`
                ];
            });
            
            // DataTable olu≈ütur
            $('#matchResultsTable').DataTable({
                data: tableData,
                order: [[5, 'desc']], // G√ºven y√ºzdesine g√∂re sƒ±rala
                pageLength: 25,
                responsive: true,
                language: {
                    url: '/static/js/turkish.json'
                },
                columnDefs: [
                    { targets: [2, 3, 4, 9], orderable: false }, // Badge kolonlarƒ± sƒ±ralama dƒ±≈üƒ±
                    { targets: [5, 6, 7, 8], type: 'num' } // Y√ºzde kolonlarƒ± sayƒ±sal
                ]
            });
        }
        
        // Gereksiz DataTables fonksiyonlarƒ± kaldƒ±rƒ±ldƒ± - kart tabanlƒ± aray√ºz kullanƒ±lƒ±yor
        
        function showLoading(elementId) {
            document.getElementById(elementId).style.display = 'block';
        }

        function hideLoading(elementId) {
            document.getElementById(elementId).style.display = 'none';
        }

        function showElement(elementId) {
            document.getElementById(elementId).style.display = 'block';
        }

        function hideElement(elementId) {
            document.getElementById(elementId).style.display = 'none';
        }

        function showAlert(type, message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            const header = document.querySelector('.header-section');
            header.parentNode.insertBefore(alertDiv, header.nextSibling);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // Diƒüer butonlar
        document.getElementById('testDeterminism').addEventListener('click', async function() {
            const week = document.getElementById('weekSelect').value;
            const dataFile = document.getElementById('dataFile').value;
            
            if (!week) {
                showAlert('warning', 'L√ºtfen bir hafta se√ßin');
                return;
            }
            
            this.disabled = true;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Test ediliyor...';
            
            try {
                const response = await fetch('/api/test-determinism', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        week: parseInt(week),
                        data_file: dataFile,
                        seed: 42
                    })
                });
                
                const data = await response.json();
                
                if (data.error) {
                    showAlert('danger', data.error);
                    return;
                }
                
                if (data.is_deterministic) {
                    // Ba≈üarƒ± mesajƒ± kaldƒ±rƒ±ldƒ± - sadece hata mesajlarƒ± g√∂sterilecek
                } else {
                    showAlert('danger', `‚ùå Determinizm Testi BA≈ûARISIZ! ${data.comparison_info}`);
                }
                
            } catch (error) {
                showAlert('danger', 'Determinizm testi hatasƒ±: ' + error.message);
            } finally {
                this.disabled = false;
                this.innerHTML = '<i class="fas fa-sync-alt"></i> Determinizm Testi';
            }
        });

        document.getElementById('clearHistory').addEventListener('click', async function() {
            try {
                const response = await fetch('/api/clear-history', { method: 'POST' });
                const data = await response.json();
                
                hideElement('backtestResults');
                // Ba≈üarƒ± mesajƒ± kaldƒ±rƒ±ldƒ± - sadece hata mesajlarƒ± g√∂sterilecek
                
            } catch (error) {
                showAlert('danger', 'Temizleme hatasƒ±: ' + error.message);
            }
        });

        // Gereksiz DataTables fonksiyonlarƒ± kaldƒ±rƒ±ldƒ± - kart tabanlƒ± aray√ºz kullanƒ±lƒ±yor

        document.getElementById('exportResults').addEventListener('click', function() {
            window.open('/api/export-results', '_blank');
        });

        // GP Fonksiyonlarƒ±
        async function checkGPStatus() {
            try {
                const response = await fetch('/api/gp-status');
                const data = await response.json();
                
                const statusDiv = document.getElementById('gpStatus');
                const predictionForm = document.getElementById('gpPredictionForm');
                
                if (data.is_trained) {
                    statusDiv.className = 'alert alert-success';
                    statusDiv.innerHTML = '<i class="fas fa-check-circle"></i> Model eƒüitilmi≈ü ve tahmin yapmaya hazƒ±r!';
                    predictionForm.style.display = 'block';
                } else {
                    statusDiv.className = 'alert alert-warning';
                    statusDiv.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Model hen√ºz eƒüitilmemi≈ü. L√ºtfen √∂nce modeli eƒüitin.';
                    predictionForm.style.display = 'none';
                }
            } catch (error) {
                const statusDiv = document.getElementById('gpStatus');
                statusDiv.className = 'alert alert-danger';
                statusDiv.innerHTML = '<i class="fas fa-times-circle"></i> Model durumu kontrol edilemedi.';
            }
        }

        async function trainGPModel() {
            const trainBtn = document.getElementById('gpTrainBtn');
            const dataFile = document.getElementById('gpDataFile').value;
            
            try {
                trainBtn.disabled = true;
                trainBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Eƒüitiliyor...';
                showLoading('gpLoading');
                
                const response = await fetch('/api/gp-train', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        data_file: dataFile
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('success', `Model ba≈üarƒ±yla eƒüitildi! ${data.message}`);
                    checkGPStatus(); // Durumu g√ºncelle
                } else {
                    showAlert('danger', 'Eƒüitim hatasƒ±: ' + (data.error || 'Bilinmeyen hata'));
                }
                
            } catch (error) {
                showAlert('danger', 'Eƒüitim hatasƒ±: ' + error.message);
            } finally {
                trainBtn.disabled = false;
                trainBtn.innerHTML = '<i class="fas fa-cogs"></i> Modeli Eƒüit';
                hideLoading('gpLoading');
            }
        }

        async function makeGPPrediction() {
            const predictBtn = document.getElementById('gpPredictBtn');
            const homeTeam = document.getElementById('gpHomeTeam').value.trim();
            const awayTeam = document.getElementById('gpAwayTeam').value.trim();
            const week = document.getElementById('gpWeek').value;
            
            if (!homeTeam || !awayTeam) {
                showAlert('warning', 'L√ºtfen takƒ±m isimlerini girin.');
                return;
            }
            
            try {
                predictBtn.disabled = true;
                predictBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Tahmin Yapƒ±lƒ±yor...';
                showLoading('gpLoading');
                
                const response = await fetch('/api/gp-predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        home_team: homeTeam,
                        away_team: awayTeam,
                        week: parseInt(week),
                        home_win_rate: parseFloat(document.getElementById('homeWinRate').value),
                        away_win_rate: parseFloat(document.getElementById('awayWinRate').value),
                        home_avg_gf: parseFloat(document.getElementById('homeAvgGoals').value),
                        away_avg_gf: parseFloat(document.getElementById('awayAvgGoals').value),
                        home_prev_matches: 15,
                        away_prev_matches: 15,
                        home_prev_wins: Math.round(15 * parseFloat(document.getElementById('homeWinRate').value)),
                        away_prev_wins: Math.round(15 * parseFloat(document.getElementById('awayWinRate').value))
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayGPResult(data);
                    showElement('gpResults');
                } else {
                    showAlert('danger', 'Tahmin hatasƒ±: ' + (data.error || 'Bilinmeyen hata'));
                }
                
            } catch (error) {
                showAlert('danger', 'Tahmin hatasƒ±: ' + error.message);
            } finally {
                predictBtn.disabled = false;
                predictBtn.innerHTML = '<i class="fas fa-magic"></i> Tahmin Yap';
                hideLoading('gpLoading');
            }
        }

        function displayGPResult(data) {
            const resultDiv = document.getElementById('gpPredictionResult');
            
            // Tahmin sonucu badgesi
            let badgeClass = 'badge-primary';
            let resultIcon = 'fas fa-question';
            
            if (data.prediction === '1') {
                badgeClass = 'badge-success';
                resultIcon = 'fas fa-home';
            } else if (data.prediction === 'X') {
                badgeClass = 'badge-warning';
                resultIcon = 'fas fa-minus';
            } else if (data.prediction === '2') {
                badgeClass = 'badge-danger';
                resultIcon = 'fas fa-plane';
            }
            
            // G√ºven seviyesi
            let confidenceClass = 'text-muted';
            let confidenceIcon = 'fas fa-question-circle';
            
            if (data.confidence >= 70) {
                confidenceClass = 'text-success';
                confidenceIcon = 'fas fa-check-circle';
            } else if (data.confidence >= 50) {
                confidenceClass = 'text-warning';
                confidenceIcon = 'fas fa-exclamation-circle';
            } else {
                confidenceClass = 'text-danger';
                confidenceIcon = 'fas fa-times-circle';
            }
            
            resultDiv.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="metric-card">
                            <h6><i class="${resultIcon}"></i> Tahmin</h6>
                            <div class="metric-value">
                                <span class="badge ${badgeClass}">${data.prediction_text}</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="metric-card">
                            <h6><i class="${confidenceIcon}"></i> G√ºven Skoru</h6>
                            <div class="metric-value ${confidenceClass}">
                                %${data.confidence}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="alert alert-info">
                            <strong>Ma√ß:</strong> ${data.home_team} vs ${data.away_team} (Hafta ${data.week})<br>
                            <strong>Tahmin:</strong> ${data.prediction_text}<br>
                            <strong>G√ºven:</strong> %${data.confidence} 
                            ${data.confidence >= 70 ? '(Y√ºksek G√ºven)' : 
                              data.confidence >= 50 ? '(Orta G√ºven)' : '(D√º≈ü√ºk G√ºven)'}
                        </div>
                    </div>
                </div>
            `;
        }

        // Advanced GP Functions
        async function trainAdvancedGP() {
            const trainBtn = document.getElementById('trainAdvancedGPBtn');
            const league = document.getElementById('advancedGPLeague').value;
            
            if (!league) {
                showAlert('warning', 'L√ºtfen bir lig se√ßin');
                return;
            }
            
            trainBtn.disabled = true;
            trainBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Eƒüitiliyor...';
            showLoading('advancedGPLoading');
            
            try {
                const response = await fetch('/api/advanced-gp-train', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ league: league })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('success', `Geli≈ümi≈ü GP modeli ba≈üarƒ±yla eƒüitildi! Doƒüruluk: %${data.accuracy.toFixed(2)}`);
                    document.getElementById('advancedGPStatus').innerHTML = `
                        <div class="alert alert-success">
                            <strong>Model Eƒüitildi:</strong> ${league}<br>
                            <strong>Doƒüruluk:</strong> %${data.accuracy.toFixed(2)}<br>
                            <strong>√ñzellik Sayƒ±sƒ±:</strong> ${data.feature_count}
                        </div>
                    `;
                } else {
                    showAlert('danger', 'Eƒüitim hatasƒ±: ' + (data.error || 'Bilinmeyen hata'));
                }
                
            } catch (error) {
                showAlert('danger', 'Eƒüitim hatasƒ±: ' + error.message);
            } finally {
                trainBtn.disabled = false;
                trainBtn.innerHTML = '<i class="fas fa-cogs"></i> Geli≈ümi≈ü GP Eƒüit';
                hideLoading('advancedGPLoading');
            }
        }

        async function predictAdvancedGP() {
            const predictBtn = document.getElementById('predictAdvancedGPBtn');
            const homeTeam = document.getElementById('advancedGPHomeTeam').value;
            const awayTeam = document.getElementById('advancedGPAwayTeam').value;
            const week = document.getElementById('advancedGPWeek').value;
            
            if (!homeTeam || !awayTeam || !week) {
                showAlert('warning', 'L√ºtfen t√ºm alanlarƒ± doldurun');
                return;
            }
            
            predictBtn.disabled = true;
            predictBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analiz Ediliyor...';
            showLoading('advancedGPPredictLoading');
            
            try {
                const response = await fetch('/api/advanced-gp-predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        home_team: homeTeam,
                        away_team: awayTeam,
                        week: parseInt(week)
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayAdvancedGPResult(data);
                    showElement('advancedGPResults');
                } else {
                    showAlert('danger', 'Analiz hatasƒ±: ' + (data.error || 'Bilinmeyen hata'));
                }
                
            } catch (error) {
                showAlert('danger', 'Analiz hatasƒ±: ' + error.message);
            } finally {
                predictBtn.disabled = false;
                predictBtn.innerHTML = '<i class="fas fa-brain"></i> Risk Analizi Yap';
                hideLoading('advancedGPPredictLoading');
            }
        }

        function displayAdvancedGPResult(data) {
            const resultDiv = document.getElementById('advancedGPPredictionResult');
            
            let riskClass = data.risk_level === 'Low' ? 'text-success' : 
                           data.risk_level === 'Medium' ? 'text-warning' : 'text-danger';
            let riskIcon = data.risk_level === 'Low' ? 'fas fa-shield-alt' : 
                          data.risk_level === 'Medium' ? 'fas fa-exclamation-triangle' : 'fas fa-skull-crossbones';
            
            let upsetIcon = data.upset_potential ? 'fas fa-bolt text-danger' : 'fas fa-check-circle text-success';
            let upsetText = data.upset_potential ? 'S√ºrpriz Sonu√ß Olasƒ±' : 'Normal Sonu√ß Beklenir';
            
            resultDiv.innerHTML = `
                <div class="row">
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6><i class="fas fa-trophy"></i> Tahmin</h6>
                            <div class="metric-value">
                                <span class="badge badge-primary">${data.prediction}</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6><i class="fas fa-percentage"></i> G√ºven</h6>
                            <div class="metric-value text-info">
                                %${(data.confidence * 100).toFixed(1)}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6><i class="${riskIcon}"></i> Risk</h6>
                            <div class="metric-value ${riskClass}">
                                ${data.risk_level}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6><i class="fas fa-chart-line"></i> Entropi</h6>
                            <div class="metric-value text-warning">
                                ${data.entropy_score.toFixed(2)}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="alert alert-info">
                            <div class="row">
                                <div class="col-md-6">
                                    <strong><i class="${upsetIcon}"></i> S√ºrpriz Analizi:</strong> ${upsetText}
                                </div>
                                <div class="col-md-6">
                                    <strong><i class="fas fa-thermometer-half"></i> Belirsizlik:</strong> 
                                    ${data.entropy_score > 1.0 ? 'Y√ºksek' : data.entropy_score > 0.8 ? 'Orta' : 'D√º≈ü√ºk'}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Multi-League Functions
        async function trainAllLeagues() {
            const trainBtn = document.getElementById('trainAllLeaguesBtn');
            
            trainBtn.disabled = true;
            trainBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> T√ºm Ligler Eƒüitiliyor...';
            showLoading('multiLeagueTrainLoading');
            
            try {
                const response = await fetch('/api/multi-league-train', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('success', `${data.trained_leagues} lig ba≈üarƒ±yla eƒüitildi!`);
                    document.getElementById('multiLeagueStatus').innerHTML = `
                        <div class="alert alert-success">
                            <strong>Eƒüitilen Ligler:</strong> ${data.trained_leagues}<br>
                            <strong>Ortalama Doƒüruluk:</strong> %${data.average_accuracy.toFixed(2)}<br>
                            <strong>S√ºre:</strong> ${data.training_time.toFixed(1)} saniye
                        </div>
                    `;
                } else {
                    showAlert('danger', 'Eƒüitim hatasƒ±: ' + (data.error || 'Bilinmeyen hata'));
                }
                
            } catch (error) {
                showAlert('danger', 'Eƒüitim hatasƒ±: ' + error.message);
            } finally {
                trainBtn.disabled = false;
                trainBtn.innerHTML = '<i class="fas fa-globe"></i> T√ºm Ligleri Eƒüit';
                hideLoading('multiLeagueTrainLoading');
            }
        }

        async function analyzeMultiLeague() {
            const analyzeBtn = document.getElementById('analyzeMultiLeagueBtn');
            
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analiz Ediliyor...';
            showLoading('multiLeagueAnalysisLoading');
            
            try {
                const response = await fetch('/api/multi-league-analysis', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayMultiLeagueAnalysis(data);
                    showElement('multiLeagueResults');
                } else {
                    showAlert('danger', 'Analiz hatasƒ±: ' + (data.error || 'Bilinmeyen hata'));
                }
                
            } catch (error) {
                showAlert('danger', 'Analiz hatasƒ±: ' + error.message);
            } finally {
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<i class="fas fa-chart-bar"></i> Lig Kar≈üƒ±la≈ütƒ±rmasƒ±';
                hideLoading('multiLeagueAnalysisLoading');
            }
        }

        function displayMultiLeagueAnalysis(data) {
            const resultDiv = document.getElementById('multiLeagueAnalysisResult');
            
            let leaguesHtml = '';
            data.league_analysis.forEach(league => {
                let perfClass = league.performance > 0.7 ? 'text-success' : 
                               league.performance > 0.6 ? 'text-warning' : 'text-danger';
                
                leaguesHtml += `
                    <div class="col-md-4 mb-3">
                        <div class="metric-card">
                            <h6><i class="fas fa-flag"></i> ${league.league}</h6>
                            <div class="small text-muted">Performans: <span class="${perfClass}">%${(league.performance * 100).toFixed(1)}</span></div>
                            <div class="small text-muted">Rekabet: ${league.competitiveness.toFixed(2)}</div>
                            <div class="small text-muted">Tahmin Edilebilirlik: ${league.predictability.toFixed(2)}</div>
                        </div>
                    </div>
                `;
            });
            
            resultDiv.innerHTML = `
                <div class="row">
                    <div class="col-12">
                        <h5><i class="fas fa-trophy"></i> Lig Performans Analizi</h5>
                    </div>
                </div>
                <div class="row">
                    ${leaguesHtml}
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="alert alert-info">
                            <strong><i class="fas fa-lightbulb"></i> √ñneriler:</strong><br>
                            ${data.recommendations.join('<br>')}
                        </div>
                    </div>
                </div>
            `;
        }

        async function predictCrossLeague() {
            const predictBtn = document.getElementById('predictCrossLeagueBtn');
            const sourceLeague = document.getElementById('crossLeagueSource').value;
            const targetLeague = document.getElementById('crossLeagueTarget').value;
            const homeTeam = document.getElementById('crossLeagueHome').value;
            const awayTeam = document.getElementById('crossLeagueAway').value;
            const week = document.getElementById('crossLeagueWeek').value;
            
            if (!sourceLeague || !targetLeague || !homeTeam || !awayTeam || !week) {
                showAlert('warning', 'L√ºtfen t√ºm alanlarƒ± doldurun');
                return;
            }
            
            predictBtn.disabled = true;
            predictBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> √áapraz Tahmin Yapƒ±lƒ±yor...';
            showLoading('crossLeaguePredictLoading');
            
            try {
                const response = await fetch('/api/cross-league-predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        source_league: sourceLeague,
                        target_league: targetLeague,
                        home_team: homeTeam,
                        away_team: awayTeam,
                        week: parseInt(week)
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayCrossLeagueResult(data);
                    showElement('crossLeagueResults');
                } else {
                    showAlert('danger', '√áapraz tahmin hatasƒ±: ' + (data.error || 'Bilinmeyen hata'));
                }
                
            } catch (error) {
                showAlert('danger', '√áapraz tahmin hatasƒ±: ' + error.message);
            } finally {
                predictBtn.disabled = false;
                predictBtn.innerHTML = '<i class="fas fa-exchange-alt"></i> √áapraz Lig Tahmini';
                hideLoading('crossLeaguePredictLoading');
            }
        }

        function displayCrossLeagueResult(data) {
            const resultDiv = document.getElementById('crossLeaguePredictionResult');
            
            let adaptationClass = data.adaptation_score > 0.7 ? 'text-success' : 
                                 data.adaptation_score > 0.5 ? 'text-warning' : 'text-danger';
            
            resultDiv.innerHTML = `
                <div class="row">
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6><i class="fas fa-trophy"></i> Tahmin</h6>
                            <div class="metric-value">
                                <span class="badge badge-primary">${data.prediction}</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6><i class="fas fa-percentage"></i> G√ºven</h6>
                            <div class="metric-value text-info">
                                %${(data.confidence * 100).toFixed(1)}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6><i class="fas fa-exchange-alt"></i> Adaptasyon</h6>
                            <div class="metric-value ${adaptationClass}">
                                %${(data.adaptation_score * 100).toFixed(1)}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6><i class="fas fa-balance-scale"></i> Uyumluluk</h6>
                            <div class="metric-value text-warning">
                                ${data.similarity_score.toFixed(2)}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="alert alert-info">
                            <strong><i class="fas fa-info-circle"></i> √áapraz Lig Analizi:</strong><br>
                            <strong>Kaynak Lig:</strong> ${data.source_league}<br>
                            <strong>Hedef Lig:</strong> ${data.target_league}<br>
                            <strong>Lig Benzerliƒüi:</strong> ${data.similarity_score.toFixed(2)}<br>
                            <strong>Model Adaptasyonu:</strong> %${(data.adaptation_score * 100).toFixed(1)}
                        </div>
                    </div>
                </div>
            `;
        }

        // Performance Tracking Functions
        async function loadPredictionHistory() {
            const loadBtn = document.getElementById('loadHistoryBtn');
            const days = document.getElementById('historyDays').value;
            
            loadBtn.disabled = true;
            loadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Y√ºkleniyor...';
            showLoading('historyLoading');
            
            try {
                const response = await fetch('/api/prediction-history', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ days: parseInt(days) })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayPredictionHistory(data);
                    showElement('historyResults');
                } else {
                    showAlert('danger', 'Ge√ßmi≈ü y√ºkleme hatasƒ±: ' + (data.error || 'Bilinmeyen hata'));
                }
                
            } catch (error) {
                showAlert('danger', 'Ge√ßmi≈ü y√ºkleme hatasƒ±: ' + error.message);
            } finally {
                loadBtn.disabled = false;
                loadBtn.innerHTML = '<i class="fas fa-history"></i> Ge√ßmi≈üi Y√ºkle';
                hideLoading('historyLoading');
            }
        }

        function displayPredictionHistory(data) {
            const resultDiv = document.getElementById('predictionHistoryResult');
            
            let historyHtml = '';
            data.predictions.forEach(pred => {
                let riskClass = pred.risk_level === 'Low' ? 'success' : 
                               pred.risk_level === 'Medium' ? 'warning' : 'danger';
                
                historyHtml += `
                    <tr>
                        <td>${new Date(pred.timestamp).toLocaleDateString('tr-TR')}</td>
                        <td>${pred.league}</td>
                        <td>${pred.home_team} vs ${pred.away_team}</td>
                        <td><span class="badge badge-primary">${pred.prediction}</span></td>
                        <td>%${(pred.confidence * 100).toFixed(1)}</td>
                        <td><span class="badge badge-${riskClass}">${pred.risk_level}</span></td>
                        <td>${pred.entropy_score.toFixed(2)}</td>
                    </tr>
                `;
            });
            
            resultDiv.innerHTML = `
                <div class="row">
                    <div class="col-12">
                        <h5><i class="fas fa-history"></i> Tahmin Ge√ßmi≈üi (${data.total_predictions} tahmin)</h5>
                        <div class="table-responsive">
                            <table class="table table-dark table-striped">
                                <thead>
                                    <tr>
                                        <th>Tarih</th>
                                        <th>Lig</th>
                                        <th>Ma√ß</th>
                                        <th>Tahmin</th>
                                        <th>G√ºven</th>
                                        <th>Risk</th>
                                        <th>Entropi</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${historyHtml}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        async function trackPerformance() {
            const trackBtn = document.getElementById('trackPerformanceBtn');
            
            trackBtn.disabled = true;
            trackBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analiz Ediliyor...';
            showLoading('performanceLoading');
            
            try {
                const response = await fetch('/api/performance-tracking', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayPerformanceTracking(data);
                    showElement('performanceResults');
                } else {
                    showAlert('danger', 'Performans analizi hatasƒ±: ' + (data.error || 'Bilinmeyen hata'));
                }
                
            } catch (error) {
                showAlert('danger', 'Performans analizi hatasƒ±: ' + error.message);
            } finally {
                trackBtn.disabled = false;
                trackBtn.innerHTML = '<i class="fas fa-chart-line"></i> Performans Analizi';
                hideLoading('performanceLoading');
            }
        }

        function displayPerformanceTracking(data) {
            const resultDiv = document.getElementById('performanceTrackingResult');
            
            let trendClass = data.trend === 'improving' ? 'text-success' : 
                            data.trend === 'declining' ? 'text-danger' : 'text-warning';
            let trendIcon = data.trend === 'improving' ? 'fas fa-arrow-up' : 
                           data.trend === 'declining' ? 'fas fa-arrow-down' : 'fas fa-minus';
            
            resultDiv.innerHTML = `
                <div class="row">
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6><i class="fas fa-percentage"></i> Ortalama Doƒüruluk</h6>
                            <div class="metric-value text-success">
                                %${(data.average_accuracy * 100).toFixed(1)}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6><i class="fas fa-shield-alt"></i> Ortalama G√ºven</h6>
                            <div class="metric-value text-info">
                                %${(data.average_confidence * 100).toFixed(1)}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6><i class="${trendIcon}"></i> Trend</h6>
                            <div class="metric-value ${trendClass}">
                                ${data.trend === 'improving' ? 'ƒ∞yile≈üiyor' : 
                                  data.trend === 'declining' ? 'K√∂t√ºle≈üiyor' : 'Stabil'}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6><i class="fas fa-calculator"></i> Toplam Tahmin</h6>
                            <div class="metric-value text-warning">
                                ${data.total_predictions}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="alert alert-info">
                            <strong><i class="fas fa-info-circle"></i> Performans √ñzeti:</strong><br>
                            Son ${data.days_analyzed} g√ºnde ${data.total_predictions} tahmin yapƒ±ldƒ±.<br>
                            Model performansƒ± ${data.trend === 'improving' ? 'iyile≈üme' : 
                                                data.trend === 'declining' ? 'k√∂t√ºle≈üme' : 'stabil kalma'} eƒüiliminde.
                        </div>
                    </div>
                </div>
            `;
        }

        async function analyzeFeatureImportance() {
            const analyzeBtn = document.getElementById('analyzeFeatureBtn');
            const league = document.getElementById('featureImportanceLeague').value;
            
            if (!league) {
                showAlert('warning', 'L√ºtfen bir lig se√ßin');
                return;
            }
            
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analiz Ediliyor...';
            showLoading('featureImportanceLoading');
            
            try {
                const response = await fetch('/api/feature-importance', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ league: league })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayFeatureImportance(data);
                    showElement('featureImportanceResults');
                } else {
                    showAlert('danger', '√ñzellik analizi hatasƒ±: ' + (data.error || 'Bilinmeyen hata'));
                }
                
            } catch (error) {
                showAlert('danger', '√ñzellik analizi hatasƒ±: ' + error.message);
            } finally {
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<i class="fas fa-weight-hanging"></i> √ñzellik √ñnem Analizi';
                hideLoading('featureImportanceLoading');
            }
        }

        function displayFeatureImportance(data) {
            const resultDiv = document.getElementById('featureImportanceResult');
            
            let featuresHtml = '';
            data.feature_importance.forEach((feature, index) => {
                let barWidth = (feature.importance * 100).toFixed(1);
                let colorClass = index < 3 ? 'bg-success' : index < 6 ? 'bg-warning' : 'bg-info';
                
                featuresHtml += `
                    <div class="row mb-2">
                        <div class="col-md-4">
                            <small><strong>${feature.feature}</strong></small>
                        </div>
                        <div class="col-md-6">
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar ${colorClass}" style="width: ${barWidth}%">
                                    ${barWidth}%
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <small class="text-muted">#${index + 1}</small>
                        </div>
                    </div>
                `;
            });
            
            resultDiv.innerHTML = `
                <div class="row">
                    <div class="col-12">
                        <h5><i class="fas fa-weight-hanging"></i> √ñzellik √ñnem Sƒ±ralamasƒ± (${data.league})</h5>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        ${featuresHtml}
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="alert alert-info">
                            <strong><i class="fas fa-lightbulb"></i> √ñnemli √ñzellikler:</strong><br>
                            En etkili 3 √∂zellik: <strong>${data.top_features.join(', ')}</strong><br>
                            Bu √∂zellikler tahmin doƒüruluƒüunda en b√ºy√ºk etkiye sahip.
                        </div>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>